# ğŸ§µ ì½”ë£¨í‹´ì´ë€?
ì½”ë£¨í‹´ì€ í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ì¤‘ë‹¨í•˜ê³  ë‹¤ì‹œ ì¬ê°œí•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.  ì¼ë°˜ í•¨ìˆ˜ëŠ” í˜¸ì¶œë˜ë©´ ëë‚  ë•Œê¹Œì§€ ì‹¤í–‰ë˜ì§€ë§Œ,  ì½”ë£¨í‹´ì€ co_await, co_yield, co_return ê°™ì€ í‚¤ì›Œë“œë¥¼ í†µí•´ ì¤‘ê°„ì— ë©ˆì·„ë‹¤ê°€ ë‹¤ì‹œ ì´ì–´ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ—ï¸ Boost Coroutine vs C++ Coroutine
| íŠ¹ì§• | Boost Coroutine | C++20/23 Coroutine |
|------|-----------------|--------------------| 
| êµ¬í˜„ ë°©ì‹ | ìŠ¤íƒ ê¸°ë°˜ (stackful) | ìŠ¤íƒë¦¬ìŠ¤ (stackless), ì»´íŒŒì¼ëŸ¬ ì§€ì› | 
| í‚¤ì›Œë“œ ì§€ì› | ì—†ìŒ | co_await, co_yield, co_return | 
| í‘œì¤€ ì§€ì› ì—¬ë¶€ | ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš” | C++20ë¶€í„° í‘œì¤€ ì§€ì› | 
| ì œì–´ íë¦„ | push_type, pull_typeë¡œ ëª…ì‹œì  ì œì–´ | co_awaitë¡œ ë¹„ë™ê¸° íë¦„ ì œì–´ ê°€ëŠ¥ | 
| ì˜ˆì™¸ ì²˜ë¦¬ | ìˆ˜ë™ ì²˜ë¦¬ | try/catchì™€ co_await ì—°ë™ ê°€ëŠ¥ | 



## ğŸš€ C++20/23 Coroutine ê¸°ë³¸ êµ¬ì¡°
```cpp
#include <coroutine>
#include <iostream>

struct Generator {
    struct promise_type;
    using handle_type = std::coroutine_handle<promise_type>;

    struct promise_type {
        int current_value;
        auto get_return_object() { return Generator{handle_type::from_promise(*this)}; }
        auto initial_suspend() { return std::suspend_always{}; }
        auto final_suspend() noexcept { return std::suspend_always{}; }
        auto yield_value(int value) {
            current_value = value;
            return std::suspend_always{};
        }
        void return_void() {}
        void unhandled_exception() { std::exit(1); }
    };

    handle_type coro;

    Generator(handle_type h) : coro(h) {}
    ~Generator() { if (coro) coro.destroy(); }

    bool next() {
        if (!coro.done()) {
            coro.resume();
            return true;
        }
        return false;
    }

    int value() const { return coro.promise().current_value; }
};

Generator counter(int start, int end) {
    for (int i = start; i <= end; ++i)
        co_yield i;
}
```

## ğŸ§ª ì‚¬ìš© ì˜ˆì‹œ
```cpp
int main() {
    auto gen = counter(1, 3);
    while (gen.next()) {
        std::cout << gen.value() << std::endl;
    }
}
```

## ğŸ“¤ ì¶œë ¥:
```
1
2
3
```


## ğŸ§µ std::suspend_alwaysì™€ std::suspend_never
ì´ ë‘˜ì€ ì½”ë£¨í‹´ì˜ ì¤‘ë‹¨(suspend) ë™ì‘ì„ ì •ì˜í•˜ëŠ” íƒ€ì…ì…ë‹ˆë‹¤.  ì½”ë£¨í‹´ì€ íŠ¹ì • ì§€ì ì—ì„œ ì‹¤í–‰ì„ ë©ˆì¶”ê³ , ë‚˜ì¤‘ì— ë‹¤ì‹œ ì¬ê°œí•  ìˆ˜ ìˆëŠ”ë°, ì´ suspend ê°ì²´ë“¤ì´ ê·¸ íƒ€ì´ë°ì„ ê²°ì •í•´ìš”.
### ğŸ”¹ std::suspend_always
```cpp
auto initial_suspend() { return std::suspend_always{}; }
```

- ì½”ë£¨í‹´ì´ ì‹œì‘ë˜ìë§ˆì ì¤‘ë‹¨ë¨
- ì™¸ë¶€ì—ì„œ resume()ì„ í˜¸ì¶œí•´ì•¼ ì‹¤í–‰ë¨
- ì£¼ë¡œ ì œì–´ê¶Œì„ í˜¸ì¶œìì—ê²Œ ë„˜ê¸°ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©
### ğŸ”¸ std::suspend_never
```cpp
auto initial_suspend() { return std::suspend_never{}; }
```

- ì½”ë£¨í‹´ì´ ìƒì„±ë˜ë©´ ì¦‰ì‹œ ì‹¤í–‰ë¨
- ì¤‘ë‹¨ ì—†ì´ ë°”ë¡œ ë³¸ë¬¸ìœ¼ë¡œ ì§„ì…
- ì£¼ë¡œ ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë£¨í‹´ì— ì‚¬ìš©

### ğŸ”§ from_promise
ì½”ë£¨í‹´ì€ ë‚´ë¶€ì ìœ¼ë¡œ promise_typeì´ë¼ëŠ” êµ¬ì¡°ì²´ë¥¼ í†µí•´ ìƒíƒœë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.  from_promiseëŠ” ì´ promise_typeì—ì„œ **ì½”ë£¨í‹´ í•¸ë“¤(coroutine_handle)**ì„ ìƒì„±í•˜ëŠ” ì •ì  í•¨ìˆ˜ì…ë‹ˆë‹¤.
```cpp
auto get_return_object() {
    return Generator{std::coroutine_handle<promise_type>::from_promise(*this)};
}
```

### âœ… ì—­í• 
- promise_type ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì½”ë£¨í‹´ í•¸ë“¤ ìƒì„±
- í•¸ë“¤ì„ í†µí•´ ì½”ë£¨í‹´ì„ resume(), destroy() ë“±ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥
- *thisëŠ” í˜„ì¬ promise_type ê°ì²´ë¥¼ ê°€ë¦¬í‚´

### ğŸ§  ì „ì²´ íë¦„ ìš”ì•½
```cpp
struct promise_type {
    auto get_return_object();     // ì½”ë£¨í‹´ í•¸ë“¤ ë°˜í™˜
    auto initial_suspend();       // ì‹œì‘ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€ ê²°ì •
    auto final_suspend();         // ì¢…ë£Œ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€ ê²°ì •
    auto yield_value(T value);    // co_yield ì‹œ ë™ì‘ ì •ì˜
    void return_void();           // co_return ì‹œ ë™ì‘ ì •ì˜
    void unhandled_exception();   // ì˜ˆì™¸ ì²˜ë¦¬
};
```

- initial_suspend() â†’ ì½”ë£¨í‹´ ì‹œì‘ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€
- final_suspend() â†’ ì½”ë£¨í‹´ ì¢…ë£Œ ì‹œ ì¤‘ë‹¨ ì—¬ë¶€
- from_promise() â†’ ì½”ë£¨í‹´ í•¸ë“¤ ìƒì„±
- yield_value() â†’ co_yield ì‹œ ê°’ ì €ì¥ ë° ì¤‘ë‹¨

## ğŸ¯ ì‹¤ì „ íŒ
- std::suspend_alwaysëŠ” ì œì–´ê¶Œì„ í˜¸ì¶œìì—ê²Œ ë„˜ê¸°ê³  ì‹¶ì„ ë•Œ ìœ ìš©
- from_promiseëŠ” ì½”ë£¨í‹´ í•¸ë“¤ì„ ì•ˆì „í•˜ê²Œ ìƒì„±í•˜ëŠ” í•µì‹¬
- ì´ë“¤ì„ ì˜ í™œìš©í•˜ë©´ ë²”ìœ„ ê¸°ë°˜ ë°˜ë³µì, ë¹„ë™ê¸° ì‘ì—…, ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë° ë“± ë‹¤ì–‘í•œ íŒ¨í„´ì„ êµ¬í˜„í•  ìˆ˜ ìˆì–´ìš”

## ë™ì‘ ì›ë¦¬
```mermaid
flowchart TD
    A["ì½”ë£¨í‹´ í˜¸ì¶œ: counter()"] --> B["get_return_object()"]
    B --> C["from_promise(*this)"]
    C --> D["ì½”ë£¨í‹´ í•¸ë“¤ ìƒì„±"]
    D --> E["initial_suspend()"]
    E -->|std::suspend_always| F["ì½”ë£¨í‹´ ì¤‘ë‹¨ë¨"]
    F --> G["í˜¸ì¶œìê°€ resume()"]
    G --> H["co_yield i"]
    H --> I["yield_value(i)"]
    I --> J["ì½”ë£¨í‹´ ì¤‘ë‹¨ë¨"]
    J --> K["í˜¸ì¶œìê°€ resume()"]
    K --> L["ë‹¤ìŒ co_yield ë˜ëŠ” ì¢…ë£Œ"]
    L --> M["final_suspend()"]
    M -->|std::suspend_always| N["ì½”ë£¨í‹´ ì¢…ë£Œ ëŒ€ê¸°"]
    N --> O["destroy()ë¡œ ìì› í•´ì œ"]
```

### ğŸ” ì„¤ëª… ìš”ì•½
- get_return_object()ì—ì„œ from_promiseë¥¼ í†µí•´ ì½”ë£¨í‹´ í•¸ë“¤ì´ ìƒì„±ë©ë‹ˆë‹¤.
- initial_suspend()ì—ì„œ std::suspend_alwaysë¥¼ ë°˜í™˜í•˜ë©´ ì½”ë£¨í‹´ì€ ì¦‰ì‹œ ì¤‘ë‹¨ë˜ê³ , í˜¸ì¶œìê°€ resume()ì„ í†µí•´ ì œì–´í•©ë‹ˆë‹¤.
- co_yieldëŠ” ê°’ì„ ìƒì„±í•˜ê³  yield_value()ë¥¼ í†µí•´ ì €ì¥í•œ ë’¤ ë‹¤ì‹œ ì¤‘ë‹¨ë©ë‹ˆë‹¤.
- ë°˜ë³µì ìœ¼ë¡œ resume()ì„ í˜¸ì¶œí•˜ë©´ ë‹¤ìŒ ê°’ì„ ìƒì„±í•˜ê±°ë‚˜ ì¢…ë£Œë¡œ ì§„ì…í•©ë‹ˆë‹¤.
- final_suspend()ì—ì„œë„ std::suspend_alwaysë¥¼ ë°˜í™˜í•˜ë©´ ì¢…ë£Œ ì§ì „ ìƒíƒœì—ì„œ ëŒ€ê¸°í•©ë‹ˆë‹¤.
- ë§ˆì§€ë§‰ìœ¼ë¡œ destroy()ë¥¼ í˜¸ì¶œí•´ ì½”ë£¨í‹´ ìì›ì„ í•´ì œí•©ë‹ˆë‹¤.


## ğŸ” gen.next()ì˜ ì—­í• 
```cpp
while (gen.next()) {
    std::cout << gen.value() << std::endl;
}
```

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥
- ì½”ë£¨í‹´ì„ ì¬ê°œ: ì¤‘ë‹¨ëœ ì½”ë£¨í‹´ì„ ë‹¤ì‹œ ì‹¤í–‰
- ë‹¤ìŒ co_yieldê¹Œì§€ ì§„í–‰: ë‹¤ìŒ ê°’ì„ ìƒì„±í•˜ê³  ì¤‘ë‹¨
- ì¢…ë£Œ ì—¬ë¶€ ë°˜í™˜: ë” ì´ìƒ ìƒì„±í•  ê°’ì´ ì—†ìœ¼ë©´ false ë°˜í™˜

### ğŸ§  ë‚´ë¶€ ë™ì‘ íë¦„
```cpp
bool next() {
    if (!coro.done()) {
        coro.resume();   // ì½”ë£¨í‹´ ì¬ê°œ
        return true;     // ì•„ì§ ê°’ì´ ìˆìŒ
    }
    return false;        // ì½”ë£¨í‹´ ì¢…ë£Œë¨
}
```

- coro.done()ì€ ì½”ë£¨í‹´ì´ ì¢…ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
- coro.resume()ì€ ì½”ë£¨í‹´ì„ ì¬ê°œí•˜ì—¬ ë‹¤ìŒ co_yieldê¹Œì§€ ì‹¤í–‰
- ê°’ì€ promise_type.current_valueì— ì €ì¥ë˜ì–´ value()ë¡œ ì ‘ê·¼

### ğŸ§¬ gen.next() ë™ì‘
```mermaid
sequenceDiagram
    participant Main as í˜¸ì¶œì (main)
    participant Gen as Generator
    participant Coro as Coroutine

    Main->>Gen: gen.next()
    Gen->>Coro: resume()
    Coro->>Coro: ì‹¤í–‰ â†’ co_yield
    Coro->>Gen: ê°’ ì €ì¥ (current_value)
    Gen->>Main: true ë°˜í™˜
    Main->>Gen: gen.value()
    Gen->>Main: ê°’ ë°˜í™˜
    Main->>Gen: gen.next() (ë‹¤ìŒ ë°˜ë³µ)
    Gen->>Coro: resume()
    Coro->>Coro: ì‹¤í–‰ â†’ ì¢…ë£Œ
    Coro->>Gen: done() â†’ true
    Gen->>Main: false ë°˜í™˜
```


### ğŸ§ª ì˜ˆì‹œ íë¦„
```cpp
Generator<int> gen = countUpTo(2);
gen.next(); // â†’ co_yield 0
gen.value(); // â†’ 0
gen.next(); // â†’ co_yield 1
gen.value(); // â†’ 1
gen.next(); // â†’ co_yield 2
gen.value(); // â†’ 2
gen.next(); // â†’ ì¢…ë£Œë¨ â†’ false
```


### ğŸ§© ìš”ì•½
| ë©”ì„œë“œ | ì—­í•  |
|------|------| 
| next() | ì½”ë£¨í‹´ ì¬ê°œ, ë‹¤ìŒ ê°’ ìƒì„± | 
| value() | í˜„ì¬ ìƒì„±ëœ ê°’ ë°˜í™˜ | 
| done() | ì½”ë£¨í‹´ ì¢…ë£Œ ì—¬ë¶€ í™•ì¸ | 
| resume() | ë‚´ë¶€ì ìœ¼ë¡œ ì½”ë£¨í‹´ ì‹¤í–‰ íŠ¸ë¦¬ê±° | 







## ğŸ†• C++23 ê°œì„  ì‚¬í•­
C++23ì—ì„œëŠ” ì½”ë£¨í‹´ ê´€ë ¨ ê¸°ëŠ¥ì´ ë” ì•ˆì •í™”ë˜ê³ , í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ì˜ í†µí•©ì´ ê°•í™”ë˜ì—ˆìŠµë‹ˆë‹¤:
- std::generatorê°€ ì œì•ˆë¨ (í‘œì¤€í™” ì§„í–‰ ì¤‘)
- std::task, std::async_generator ê°™ì€ ê³ ìˆ˜ì¤€ ì½”ë£¨í‹´ íƒ€ì…ì´ ë“±ì¥
- co_awaitì™€ std::future, std::stop_token ë“±ê³¼ì˜ ì—°ë™ì´ ê°•í™”ë¨

## ğŸ¯ ìš”ì•½
- Boost Coroutineì€ ìŠ¤íƒ ê¸°ë°˜ìœ¼ë¡œ ëª…ì‹œì  íë¦„ ì œì–´ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ë³µì¡í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›€
- C++20/23 Coroutineì€ ì»´íŒŒì¼ëŸ¬ê°€ ì§ì ‘ ê´€ë¦¬í•˜ë©°, co_await, co_yieldë¥¼ í†µí•´ ë¹„ë™ê¸° í”„ë¡œê·¸ë˜ë°ì— ìµœì í™”ë¨
- C++23ì—ì„œëŠ” í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ì˜ í†µí•©ì´ ê°•í™”ë˜ì–´ ì‹¤ë¬´ì—ì„œ ë” ì‰½ê²Œ í™œìš© ê°€ëŠ¥
---
